{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ResearchPlan",
  "description": "JSON Schema for the ResearchPlan produced by the DeepResearch planner (Phase 1). All objects are strict (additionalProperties=false) to keep planner outputs auditable. The 'meta' object is strict for Structured Outputs; extensible metadata is represented via meta.extra as key/value pairs. Subquestions are bounded to a small fixed maximum.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "query": { "type": "string" },
    "normalized_query": { "type": "string" },
    "scope": {
      "type": "string",
      "enum": ["repo", "subtree", "targets"]
    },
    "scope_paths": {
      "type": "array",
      "items": { "type": "string" },
      "default": []
    },
    "depth": {
      "type": "string",
      "enum": ["quick", "standard", "deep"],
      "default": "standard"
    },
    "subquestions": {
      "type": "array",
      "maxItems": 6,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "question",
          "search_queries",
          "candidate_symbols",
          "candidate_paths",
          "expected_evidence_types",
          "stop_conditions"
        ],
        "properties": {
          "id": { "type": "string" },
          "question": { "type": "string" },
          "search_queries": {
            "type": "array",
            "minItems": 1,
            "items": { "type": "string" }
          },
          "candidate_symbols": { "type": "array", "items": { "type": "string" } },
          "candidate_paths": { "type": "array", "items": { "type": "string" } },
          "expected_evidence_types": { "type": "array", "items": { "type": "string" } },
          "stop_conditions": { "type": "array", "items": { "type": "string" } },
          "note": { "type": "string" },
          "priority": { "type": "integer", "minimum": 0 }
        }
      }
    },
    "priority_targets": {
      "type": "array",
      "items": { "type": "string" },
      "default": []
    },
    "impact_hypotheses": {
      "type": "array",
      "items": { "type": "string" },
      "default": []
    },
    "budget": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "max_subquestions",
        "max_evidence_items",
        "max_files_touched",
        "max_file_bytes",
        "max_total_bytes",
        "llm_calls_default",
        "llm_calls_max"
      ],
      "properties": {
        "max_subquestions": { "type": "integer", "minimum": 0 },
        "max_evidence_items": { "type": "integer", "minimum": 0 },
        "max_files_touched": { "type": "integer", "minimum": 0 },
        "max_file_bytes": { "type": "integer", "minimum": 0 },
        "max_total_bytes": { "type": "integer", "minimum": 0 },
        "llm_calls_default": { "type": "integer", "minimum": 0 },
        "llm_calls_max": { "type": "integer", "minimum": 0 }
      }
    },
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["planner_model", "created_at", "extra"],
      "properties": {
        "planner_model": { "type": "string" },
        "created_at": {
          "type": "string",
          "description": "RFC 3339 date-time string (e.g., 2025-12-20T12:34:56Z)."
        },
        "planner_version": { "type": "string" },
        "notes": { "type": "string" },
        "extra": {
          "type": "array",
          "description": "Extensible planner-specific metadata as explicit key/value pairs.",
          "default": [],
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["key", "value"],
            "properties": {
              "key": { "type": "string", "minLength": 1 },
              "value": { "type": "string" }
            }
          }
        }
      }
    }
  },
  "required": [
    "query",
    "normalized_query",
    "scope",
    "depth",
    "subquestions",
    "priority_targets",
    "impact_hypotheses",
    "budget",
    "meta"
  ]
}
